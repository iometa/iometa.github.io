
<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hexo 主题开发 | JustSong</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.17.1/styles/railscasts.css">
    <link rel="stylesheet" href="/lightx.css">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon512.png">
    <meta name="theme-color" content="#ffffff">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141101198-4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-141101198-4');
    </script>
    
  </head>
  <body>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function () {
          navigator.serviceWorker.register('/sw.js', {scope: '/'})
            .then(function (registration) {
              // console.log('ServiceWorker registration successful with scope: ', registration.scope);
            })
            .catch(function (err) {
              console.log('ServiceWorker registration failed: ', err);
            });
        });
      }
    </script>
  <div id="page-container">
    <div id="content-wrap">
      <div class="wrapper">
        <div class="container">
            <nav>
    <ul>
      <li><a href="/">JustSong</a></li>
      <li><a href="/archives">Archives</a></li>
      <li><a href="/about">About</a></li>
    </ul>
</nav>

            <article>
  <h1>Hexo 主题开发</h1>
  <div class="contents">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备工作"><span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hexo-主题开发概述"><span class="toc-text">Hexo 主题开发概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EJS-语法简介"><span class="toc-text">EJS 语法简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目结构"><span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文章目录的实现"><span class="toc-text">文章目录的实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#词云的实现"><span class="toc-text">词云的实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#评论区的实现"><span class="toc-text">评论区的实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#计数的实现"><span class="toc-text">计数的实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试主题"><span class="toc-text">测试主题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接"><span class="toc-text">参考链接</span></a></li></ol>
  </div>
  <h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>首先我们使用 Yeoman 生成主题模板，稍微提一下，Yeoman 是一个前端项目的脚手架工具，使用 <code>npm install yo -g</code> 安装 Yeoman，然后执行 <code>npm install generator-hexo-theme -g</code>，之后我们就可以使用 <code>yo hexo-theme</code> 生成主题模板。</p>
<p>我这里已经写了一个基本功能完善的<a href="https://github.com/songquanpeng/hexo-theme-lightx" target="_blank" rel="noopener">主题</a>，你可以 fork 下来参考一下。</p>
<h2 id="Hexo-主题开发概述"><a href="#Hexo-主题开发概述" class="headerlink" title="Hexo 主题开发概述"></a>Hexo 主题开发概述</h2><p><code>layout.ejs</code> 是整个主题的框架，所有的页面都是基于此文件，通过 <code>&lt;%- body %&gt;</code> 引入其他模板文件的内容。</p>
<p><code>index.ejs</code>，<code>post.ejs</code> 等类似文件的名称不可改变，hexo 使用这些模板文件渲染对应的内容，例如 <code>index.ejs</code> 用于渲染首页，<code>post.ejs</code> 用于渲染文章。</p>
<p>主题的配置文件中的配置可以通过 <code>theme.配置</code>的形式引用。例如对于如下的配置文件：<img src="/2019/12/25/hexo-theme-development/1579343434413.png" alt="1579343434413"></p>
<p>使用<code>&lt;%= theme.highlight %&gt;</code> 可以访问到 highlight 字段的内容。</p>
<p>Hexo 的配置文件与之类似，使用 <code>config.配置</code>的形式使用。</p>
<h2 id="EJS-语法简介"><a href="#EJS-语法简介" class="headerlink" title="EJS 语法简介"></a>EJS 语法简介</h2><p>常用标签：</p>
<table>
<thead>
<tr>
<th>标签</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt;%</td>
<td style="text-align:left">程序执行</td>
</tr>
<tr>
<td>&lt;%-</td>
<td style="text-align:left">输出未转义内容</td>
</tr>
<tr>
<td>&lt;%=</td>
<td style="text-align:left">输出转义内容</td>
</tr>
</tbody>
</table>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><pre><code>.
├── README.md
├── _config.yml
├── layout
│   ├── archive.ejs
│   ├── category.ejs
│   ├── index.ejs
│   ├── layout.ejs
│   ├── page.ejs
│   ├── partials
│   │   ├── comment.ejs
│   │   ├── footer.ejs
│   │   ├── nav.ejs
│   │   └── paginator.ejs
│   ├── post.ejs
│   └── tag.ejs
└── source
    ├── favicon.ico
    └── lightx.css
</code></pre><h2 id="文章目录的实现"><a href="#文章目录的实现" class="headerlink" title="文章目录的实现"></a>文章目录的实现</h2><pre><code class="ejs">&lt;%- toc(page.content, {list_number:false}) %&gt;
</code></pre>
<h2 id="词云的实现"><a href="#词云的实现" class="headerlink" title="词云的实现"></a>词云的实现</h2><p>直接插入以下代码：</p>
<pre><code class="ejs">&lt;%- tagcloud({min_font: 16, max_font: 35, amount: 999, color: true, start_color: &#39;gray&#39;, end_color: &#39;black&#39;}) %&gt;
</code></pre>
<h2 id="评论区的实现"><a href="#评论区的实现" class="headerlink" title="评论区的实现"></a>评论区的实现</h2><p>使用 disqus 实现评论区，缺点是需要代理才能正常使用。</p>
<pre><code class="ejs">&lt;div id=&quot;comment&quot;&gt;
    &lt;% if(theme.disqus &amp;&amp; (theme.disqus.trim() !== &quot;&quot;)){%>
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function() {
        this.page.url = "<%= page.permalink %>"; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "<%= page._id %>"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };
  
      (function() {
        var d = document,
          s = d.createElement("script");
        s.src = "https://<%= theme.disqus %>.disqus.com/embed.js";
        s.setAttribute("data-timestamp", +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <%}%&gt; &lt; div&gt; < code></%}%&gt;></code></pre>
<p>其中 theme.disqus 的值为主题配置文件中的 disqus 字段的值：</p>
<p><img src="/2019/12/25/hexo-theme-development/1579343434413.png" alt="1579343434413"></p>
<h2 id="计数的实现"><a href="#计数的实现" class="headerlink" title="计数的实现"></a>计数的实现</h2><p>计数使用<a href="https://busuanzi.ibruce.info/" target="_blank" rel="noopener">不蒜子</a>:</p>
<p>在 body 标签的末尾插入：<code>&lt;script async src=&quot;//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js&quot;&gt;&lt;/script&gt;</code></p>
<p>之后直接在需要显示计数的地方插入：</p>
<pre><code class="html">PV: &lt;span id=&quot;busuanzi_value_site_pv&quot;&gt;&lt;/span&gt;
UV: &lt;span id=&quot;busuanzi_value_site_uv&quot;&gt;&lt;/span&gt;
</code></pre>
<p>优点是十分方便，不需要注册，缺点是速度有点慢，且只能统计整站的访问量。</p>
<h2 id="测试主题"><a href="#测试主题" class="headerlink" title="测试主题"></a>测试主题</h2><p>Hexo 官方有一个专门用来测试主题的仓库：</p>
<p><a href="https://github.com/hexojs/hexo-theme-unit-test.git" target="_blank" rel="noopener">https://github.com/hexojs/hexo-theme-unit-test.git</a></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://hexo.io/docs/variables.html" target="_blank" rel="noopener">Hexo API</a></li>
<li><a href="www.cnblogs.com/yyhh/p/11058985.html">Hexo 主题开发</a></li>
<li><a href="https://molunerfinn.com/make-a-hexo-theme/" target="_blank" rel="noopener">Hexo 主题开发经验杂谈</a></li>
<li><a href="https://juejin.im/entry/576d662b0a2b580058f9c5d5" target="_blank" rel="noopener">Hexo 主题开发指南</a></li>
<li><a href="https://ejs.co/" target="_blank" rel="noopener">EJS 官方文档</a></li>
</ol>

  
  <p class="copyright"><strong>Links: <a href="https://iometa.cn/2019/12/25/hexo-theme-development/">https://iometa.cn/2019/12/25/hexo-theme-development/</a></strong></p>  
</article>

<div id="comment">
    
    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function() {
        this.page.url = "https://iometa.cn/2019/12/25/hexo-theme-development/"; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "ck8zslsiy0005lkgjjpm9nm68"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };
  
      (function() {
        var d = document,
          s = d.createElement("script");
        s.src = "https://iometa.disqus.com/embed.js";
        s.setAttribute("data-timestamp", +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    
</div>
        </div>
      </div>
    </div>
    <div id="footer">
      <div class="wrapper">
        <div class="container">
          
<button id="back-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">TOP</button>
<footer>
    <div>
        <p>
            © 2020 <a href="https://iometa.cn">JustSong</a>.
            Powered by <a href="https://hexo.io/">Hexo</a>.
            Theme <a href="https://github.com/songquanpeng/hexo-theme-lightx">lightx</a>.
            
        </p>
    </div>
</footer>

        </div>
      </div>
    </div>
  </div>
  
    <script id="dsq-count-scr" src="//iometa.disqus.com/count.js" async></script>
  
  
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  </body>
</html>
